<div class="container">
  <div class="container pb-4">
    <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><%= link_to "Home", root_path, class: "text-decoration-none text-success" %></li>
        <li class="breadcrumb-item active" aria-current="page">Mis Cotizaciones</li>
      </ol>
    </nav>
  </div>

  <div class="d-flex justify-content-between container">
    <h5 class="flex-grow-1"><%= current_user.business_name %>, estas son todas tus cotizaciones:</h5>
  </div>

  <div class="container mt-5">
    <table class="table table-hover table-responsive">
      <thead class="table-light table align-middle">
        <tr>
          <th scope="col" class="ps-3">Nº</th>
          <th scope="col">Cliente</th>
          <th scope="col">Evento a Cotizar</th>
          <th scope="col">Fecha de Entrega</th>
          <th scope="col">Consulta del cliente</th>
          <th scope="col">Tu Respuesta</th>
          <th scope="col">Precio cotizado</th>
          <th scope="col">Estado de la cotizacion</th>
          <th scope="col">Estado del Servicio</th>
        </tr>
      </thead>
      <tbody class="table-light table align-middle">
        <% @estimations.each_with_index do |estimation, index| %>
          <tr class="text-start ms-1">
            <th scope="row", class="ps-3"><%= index + 1 %></th>
              <td><%= User.find(Event.find(estimation.event_id).user_id).name %></td>
              <td><%= Event.find(estimation.event_id).name %></td>
              <td><%= "#{estimation.delivery_date.day}/#{estimation.delivery_date.month}/#{estimation.delivery_date.year} " %></td>
              <td><%= estimation.comments %></td>
              <td><%= estimation.feedback %></td>
              <td><%= estimation.price %></td>
              <td><%= estimation.status %></td>
              <td>
              <% if estimation.status == "Cotizada por Proveedor" %>
                Esperando respuesta
              <% elsif estimation.status == "Pendiente" || estimation.status == "En Negociación" %>
                <%= link_to "Responder", edit_estimation_path(estimation) %>
              <% else %>
                Cerrada
              <% end %>
              </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>











</div>

  <%= link_to "Volver", root_path, class: "btn btn-primary text-light" %>



  <% @estimations.each do |estimation| %>
    <div class="border">
      <p>Evento a cotizar: <%= Event.find(estimation.event_id).name  %></p>
      <p>nombre del cliente: <%= User.find(Event.find(estimation.event_id).user_id).name %> </p>
      <p>Consulta del cliente: <%= estimation.comments  %></p>
      <p>Estado de la cotización: <%= estimation.status %></p>
      <p>Precio cotizado: <%= estimation.price %></p>
      <p>Tu respuesta: <%= estimation.feedback %></p>
      <p>Fecha de entrega solicitada: <%= estimation.delivery_date %></p>
      <p>Estado del servicio:
        <% if estimation.delivery_date <= Date.today %>
          <%= "Entregado" %>
        <% else %>
          <%= "En proceso de entrega" %>
        <% end %>
      </p>
      <% if estimation.status != 'Aceptada' && estimation.status != 'Suspendida' && estimation.status != 'Cotizada por Proveedor' %>
        <%= link_to "Responder", edit_estimation_path(estimation) %>
      <% end %>
      <% if estimation.status == 'Aceptada'%>
        <% if estimation.chatroom %>
          <%= link_to "Chat", chatroom_path(estimation.chatroom) %>
          <% else %>
          <%= button_to "Chat", estimation_chatrooms_path(estimation.id), method: :post %>
        <% end %>
      <% end %>
    </div>
  <% end %>
